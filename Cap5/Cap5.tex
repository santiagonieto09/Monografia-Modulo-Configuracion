\mychapter{Capítulo 5. Arquitectura del sistema}

En el presente capítulo se explora la arquitectura del sistema, siendo este un plan en el que se definen aspectos y decisiones importantes para el software, teniendo en cuenta los requisitos del sistema, la organización y cómo se comunican los diferentes componentes entre sí.
Es importante recordar que el software contable para uso educativo en construcción consta de múltiples módulos independientes desarrollados como microservicios: Módulo de Configuración, Módulo Comercial, Módulo de Inventario (Promedio Ponderado y PEPS), Módulo de Tesorería, Módulo de Cartera, Módulos Contable Comercial y Contable Cartera, Módulos de Reportes Financieros y Módulo Educativo Contable. A pesar de que varios de estos módulos interactúan entre sí mediante APIs REST y un servidor de descubrimiento Eureka, este proyecto se enfoca específicamente en el desarrollo del módulo de Configuración, que proporciona los parámetros maestros fundamentales para el funcionamiento de todo el sistema.

Este apartado profundiza en la arquitectura del módulo de Configuración y detalla su relación con los módulos de Inventario (Promedio Ponderado y PEPS) y Cartera, los cuales presentan un avance suficiente para permitir la comunicación entre servicios. Por otro lado, la documentación técnica necesaria para que los demás microservicios en desarrollo puedan integrarse con los submódulos de Configuración se presenta detalladamente del \autoref{AnexoA} al \autoref{AnexoH}.

Para describir la arquitectura del sistema se emplea el modelo C4, que contempla cuatro diagramas principales: Contexto, Contenedores, Componentes y Código. Dado que el módulo de Configuración está compuesto por múltiples submódulos, se utiliza el submódulo de Catálogo de Cuentas como referencia para ilustrar la arquitectura C4, ya que los demás submódulos comparten una estructura similar. Los diagramas C4 de todos los submódulos se encuentran disponibles en el siguiente \href{https://drive.google.com/drive/folders/1O5IuTREhMx5zNiTa6Jo7ET5LC2ph4cPg?usp=sharing}{\underline{\textcolor{blue}{enlace}}}.

\section{Modelo C4: Descripción de la arquitectura}

\subsection{Diagrama de contexto}

El diagrama de contexto del sistema que se muestra en la \autoref{fig:Contexto} representa la vista de más alto nivel dentro del modelo C4, proporcionando una representación visual integral del sistema educativo contable CONTAPP en desarrollo. Este diagrama ilustra cómo el sistema se integra en su entorno operativo, mostrando dos aspectos fundamentales:

\begin{itemize}
 \item Las personas que utilizan el sistema y sus diferentes roles
 \item Los sistemas de software externos con los que interactúa y se conecta
\end{itemize}

\begin{figure}[h!]    
    \centering%
    \includegraphics[width=1.0\textwidth, height=1.0\textheight, keepaspectratio]{Cap5/Figuras/contexto.png}    
    \caption{Diagrama de contexto.}
    \label{fig:Contexto}
\end{figure}

\subsection{Diagrama de contenedores}
En la \autoref{fig:contenedor} se puede observar el diagrama de contenedores, el cual tiene como objetivo proporcionar una visión con nivel de detalle medio para comprender la organización interna del sistema y las responsabilidades de los diferentes contenedores que conforman la arquitectura del software contable educativo.

El sistema consta de seis contenedores principales: aplicación web, API Gateway, servicio de descubrimiento, microservicios, Keycloak y base de datos. La aplicación web desarrollada en Angular 19 se comunica con los microservicios a través del API Gateway mediante un sistema REST (Representational State Transfer), de este modo el backend expone servicios web que implementan una API REST siguiendo sus principios fundamentales \cite{DominaArquitectura}:

\begin{itemize}
\item \textbf{Cliente-Servidor:} La aplicación web (cliente) y los microservicios (servidor) son independientes; la única forma de comunicación son las peticiones HTTP que fluyen a través del API Gateway.
\item \textbf{Sin estado:} Los microservicios no almacenan información de sesión; cada petición es independiente y contiene toda la información necesaria para procesarla, incluyendo el token JWT para autenticación.
\item \textbf{Identificador único:} Cada recurso del sistema (cuentas contables, terceros, productos, impuestos) se identifica mediante URIs únicas que permiten su acceso y manipulación de forma irrepetible.
\item \textbf{Uso de HTTP:} Se respetan los verbos HTTP estándar (GET para consultas, POST para creación, PUT para actualización, DELETE para eliminación) y los códigos de respuesta apropiados para cada operación. 
\end{itemize}

\begin{figure}[h!]    
    \centering%
    \includegraphics[width=1.0\textwidth, height=1.0\textheight, keepaspectratio]{Cap5/Figuras/contenedor.png}    
    \caption{Diagrama de contenedores.}
    \label{fig:contenedor}
\end{figure}

\newpage

La descripción de cada contenedor y la participación del presente proyecto se encuentra en la \autoref{tab:contenedores}.

\input{Cap5/Tablas/contenedores.tex}


\newpage
\subsection{Diagrama de componentes}

En la \autoref{fig:componentes} se puede observar el diagrama de componentes del contenedor asociado al submódulo de Catálogo de Cuentas, este tiene como objetivo detallar los componentes y cómo estos interactúan, proporcionando un nivel de detalle alto. Uno de los patrones arquitectónicos que se pueden ver reflejados en este diagrama, es el patrón de arquitectura limpia (o hexagonal), para practicidad en la lectura del presente diagrama se ha dividido en secciones que corresponden a las capas mencionadas: Domain, Application, Infraestructure.

\begin{figure}[h!]    
    \centering%
    \includegraphics[width=1.0\textwidth, height=1.0\textheight, keepaspectratio]{Cap5/Figuras/componentes.png}    
    \caption{Diagrama de componentes submódulo Catálogo de Cuentas.}
    \label{fig:componentes}
\end{figure}


\section{Patrones arquitectónicos del backend}

En el módulo de Configuración se emplearon dos patrones arquitectónicos principales: La arquitectura hexagonal y la arquitectura en capas. Esta decisión responde a la evolución del proyecto bajo el enfoque PBL. Durante la Fase 1, los submódulos de Terceros, Productos, Impuestos y Catálogo de cuentas fueron desarrollados siguiendo el patrón hexagonal, por lo que se optó por mantener esta arquitectura para aprovechar el trabajo previo de los desarrolladores, quienes ya habían implementado funcionalidades importantes que posteriormente se adaptaron para satisfacer los nuevos requerimientos del cliente. Por otro lado, los submódulos restantes como Métodos de pago, Tipos de documentos, Bancos, Cuentas bancarias, Centros de costo, Centro de ayuda y Calendario contable corresponden principalmente a funcionalidades CRUD sin lógica de negocio compleja, por lo que se implementaron utilizando el patrón de arquitectura en capas, priorizando la simplicidad y la mantenibilidad. A continuación se describen de manera conceptual y gráfica los patrones arquitectónicos implementados.


\subsection{Arquitectura hexagonal en el submódulo de Catálogo de Cuentas}

\subsection{Arquitectura en capas en el submódulo de......}